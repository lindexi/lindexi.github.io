
# 代码设计能力提升之路

代码设计能力是一个比较虚的话题，世界上也没有一个可以准确客观衡量设计能力的标准。主观来感觉，代码设计能力的强弱，对于开发者来说，还是比较重要的。有一些代码一看就觉得有设计感，无论是对在此代码基础上进行扩展开发，还是在代码内进行变更，或者是调用此代码的逻辑，都会感觉十分顺畅。但有一些代码，写之前只有神明和开发者知道，写完之后，只要神明才知道这些代码的含义
代码设计能力属于一个比较难以描述的能力。有些开发者天赋很好，刚开始接触代码就能写出富有设计感的代码。有些开发者则不然，但好在代码设计能力是一个可以通过训练获取的能力，是能够练出来的能力。我将给大家列出我所了解的代码设计能力的提升的方向和思路，期望对大家有所帮助

<!--more-->


<!-- CreateTime:2022/6/27 8:20:53 -->

<!-- 草稿 -->

## 背景

在开始之前必须说明的是，本文属于只对设计新手友好，对于刚入行或者刚接触编程的初学者来说不友好，对于行业“老司机”资深开发大佬不友好

对于刚入行或者刚接触编程的初学者，十分 **十分** 不建议阅读本文。强行按照本文的方式进行练习，只会让你的代码逻辑十分糟糕。本文所面向的设计新手指的是，了解编程语言的知识，包括基础和稍微进阶部分的知识，了解平台框架提供的能力和熟悉使用方法的开发者。如果对于语言和框架本身熟悉度不够，我十分不建议此时开始学习代码设计，核心原因在于设计出来的东西和语言框架本身提供的可能经常背道而驰，形成不良习惯

本文面向的是设计新手，将会影响很多细节逻辑的描述，这对于行业“老司机”资深开发大佬来说，也许看起来有些难受。而且设计能力是各个人都有各个人自己的特色，贸然更换自己的风格绝对不是好的事情。推荐对于大佬们来说，本文就看着玩就好了，不要受到我的影响

我在进入公司的时候，当时看到了团队里面很多前辈写的库和框架，我十分眼红，因为我发现团队里面的前辈们写的代码似乎和我写的方式有着很大的差别。尽管都是使用相同的 C# 语言，还是那些基础知识，然而组织起来的代码结构就远远不是我之前能想象出来的。再加上我之前一直都有一个问题，那就是我实际工作之前，做了好几个小的项目，经常发现，写着写着我就开始写不下了，当项目稍微大到一定的规模的时候，我就发现尽管只有我一个开发者，然而我自己都会和自己冲突。项目稍微大到一定的规模的时候，我就无法把控整个项目，项目代码的走向完全都是看天的。当时我就特别想学会前辈们的这项技能，如何将库，将框架，将项目组织起来，可以容纳很多位开发者进行长时间的开发

我询问了很多位前辈，刚开始很担心的问题是，这个事情是不是很看天分。我加入公司之前，我自认自己是写了很多代码了，但为什么我就没有达到这个水平。好在经过一番了解之后，代码设计这个能力，尽管和天赋是有相关性的，但好在代码设计能力是一个可以通过训练获取的能力。前辈们当时给我和我同一届的新人的训练方法是 “多练练” 的方式，经过了好多年我回顾当时的做法，发现这确实是一个十分行之有效的方式

对于代码设计能力来说，不要想着有速成的方法。几乎任何采用速成的方式基本都是歪路。多进行刻意的训练，才能提升代码设计能力

不过回顾我自己的成长路线，我发现了当时我也走了很多奇怪的路线，我现在也带过了很多位徒弟，感觉我可以开始将这部分经验写下来，提供给大家参考。期望能让设计新手们在设计能力提升之路上能有一个方向，知道要刻意训练什么，少一点歪路

## 理清概念理清需求

为什么很多书和技术文档的一开始就是先来一个术语表以及概念介绍？这是因为在描述一个事物的时候，不同的开发者有着不同的理解。如果没有能够将描绘相同的事物下一个确切的定义，那将会导致后续的表述过程，意思被曲解。在代码设计中也是如此，如果对于相同的事物在不同的代码逻辑里面，采用的命名或者是用法都是不相同的，那自然使用方用起来就会觉得疑惑；更可怕的是将两个不相同的事物采用很是混淆的表示方式，如相同的命名表示两个容易混淆的事物，那如此实现自然是 Bug 不断，且静态代码阅读也难以了解其中的含义

明确事物的表述，建立术语表，也是属于需求分析的一个方面。试想，如果对将要开发的工作几乎没有了解，那如何着手建立术语表，如何着手开始给各个模块和各个逻辑下定义。需求分析是第一位，特别是在开始编写设计框架之前。如果期望写出来一个能好好落地的框架，那需求分析一定是第一位。我推荐新手在接到新需求的时候，优先考虑先不要立刻进行设计框架，如果条件允许的话，推荐先开发原型应用，通过原型应用去测试对需求的理解是否存在偏差。这里需要着重聊的一点在于，需求的理解是否存在偏差，不代表着是开发者对于产品经理的需求存在偏差，而是开发出来的产品和实际市场所需要的是否存在偏差。产品经理也是人，对于实际市场所需的需求，也不可能一定能够理解准确，而产品经理大部分都是不认错的，那锅自然就会落到开发者头上了，即便是理解对了产品经理的需求，实际开发出来的产品也有可能和实际市场上所需要的需求有偏差，导致了返工。对于框架层来说的话，因为需求而需要接近推翻重来的成本是非常高的，而且如果对于需求存在本质性的理解错误，那自然设计出来的框架，很少有不需要被推翻重来的。这就是为什么我推荐新手优先考虑先不要立刻设计框架，而是应该怎么快怎么来，先搞出来一个东西，去试试水，在搞的过程中，可以美其名叫“预研”阶段。如果条件允许，团队里面能够打成一致，那自然是能开发原型产品是最好的。所谓原型产品可以理解为一堆 Demo 级的代码，作出一个只能用来进行有限的演示的东西，实际里面的代码能够真正落到最终产品上的，那是非常少的。如果条件不允许，而且此产品需求是具备多个版本的情况下，优先第一个版本不做设计，先尝试交付出第一个版本之后，再来开始进行设计框架。通常这个时候，第一个出去的版本，也能帮助暴露出问题，以及帮助自己赢得一些设计框架所需的时间。如果实在没有条件，头铁的话，那就上吧，直接开始设计，即使失败了，也算是加一些经验吧

在需求大概了解之后，开始着手写框架之前，还需要问问自己，对于各个概念，是否理清了。比如说开发某些行业相关比较强的应用，是否自己理解的各个名词，各个概念，和行业里面通用理解的是相同的，有些可能混淆的概念，是否能够理清了。大部分情况下，能理清越多，那埋下的技术债务也就会越少。最怕的是存在某个概念，张冠李戴，然后还为此造了很多逻辑，而且还难以改动，那就特别闹心了。理清概念，不仅可以让自己和团队其他成员沟通起来方便，更重要的是，有很多知识可以通过搜索引擎来搜，和社区里面，如群里面的大佬们交流的时候，会更加的方便。另外计算机行业里面的编程语言，从一定的角度上也是一门语言，只要是个语言，就不可避免的存在语言的限制，描述的事物和具体期望描述的事务存在一定的偏差。特别是在框架的实现逻辑上，很多时候，所设计的数据结构和所采用的逻辑算法，将会直接影响编写的代码的方式，以及影响整个框架的设计表示。这一类问题，类似于盲人摸象的问题。我用一个小故事来方便大家理解：

在数学世界里面，有一群小人儿，这些小人儿生活在2D的欧氏平面几何世界上，这些小人儿能用来描述物体的词汇只有三角形、四方形、长方形、圆形等基础图形。当某一天小人儿们碰到来自3D世界的一个圆柱体的时候，小人儿们围了过去。挤不进里面的小人儿唧唧喳喳好奇地问着在里圈的小人儿，这是什么东西。有小人儿说，这是一个圆形；有小人儿说，这是一个长方形；也有小人儿说，这是一个不可描述的事物。在外圈的小人儿觉得很奇怪，觉得里圈的小人儿们描述起来很是自相矛盾。在小人儿的认知里面，不可能相同的一个物体同时是圆形也同时是长方形，因为这在定义上是矛盾的。在2D的欧氏平面几何世界里，能够是长方形的就一定不是圆形，反过来也是。外圈的小人儿们无法理解，其实里圈的小人儿们说的都对，只是里圈不同的小人儿的观测角度不同而已。由于观测角度不同，所见物体在2D的欧氏平面几何世界的投影也就不相同，投影出来的给小人儿们所见的几何图形也自然就不相同

其实现实世界里面也是，当人们在尝试描述一个超出认知的事情的时候，不同的人处于不同的观测角度，所见到的事物将会是不相同的，而受限于语言，描述出来的事物更是片面的。这也是盲人摸象这个成语所说的内容。在代码逻辑编写和框架设计的时候，更是如此。假定自己的知识存在盲区，就如同生活在2D的欧氏平面几何世界上的小人儿，由于认知上不存在 3D 物体，也就意味着语言上没有与此匹配的概念，对相同的事物将存在不同的表述。具体到代码设计上，那就是完成相同的一个事情，采用的设计的逻辑是片面的，而且还在一个框架里面，存在多个不同的实现逻辑都是为了解决相同的问题的不同的方面，而没有采用准确的逻辑来解决此问题。这也就是为什么我建议编程新手不要一开始就学习代码设计的原因，在对编程语言不够熟悉，对自己所使用的语言的基础设施和基础类库都还不熟悉的情况下，那自然很容易出现因为编程知识的盲区，而进行很多诡异且不合理的设计。更可怕的是，如果刚好所遇见的问题都在某一个片面的领域里面，就如同故事里面的某个小人儿对圆柱体的理解是一个圆形一样，编程新手如果一直没有跳出自己的圈子，那所见到的都如同只看到圆柱体是圆形的一面的小人儿一样，刚好将圆柱体认为是圆形，刚好问题都能解决。如此会给自己形成错误的经验，而且自己还难以知道




全部用结构体，为了提升性能？不对，需求是不是要求性能？

图书馆，提升借书效率，引入自动找书机器人，抽象了人工去根据书号获取，实际是学生自己去拿书


## 从减少重复代码开始

设计能力的提升可以从减少重复代码开始

稍微学过编程的伙伴都知道，重复的代码是一个技术债务。假设没有封装好的基础库，所有新功能开发都必须去找代码拷贝，而且一遇到某个问题，就要修无数的重复的代码。重复的代码的抽离和封装是比较简单的事情，如果代码是完全重复的情况下，那自然是将这些重复的代码封装为一个方法，逻辑依然是能保持不动

练习的第一步就是找到重复的代码，将重复的代码抽成方法，试试换成方法调用。第二步自然就是遇到了只抽成方法无法实现的能力，例如重复的代码的使用是在多个类里面，之间的方法是不能共用的，此时就可以考虑将重复的代码从方法提升到类型。新建一个类型，包含重复的代码的封装

如此写着写着就会发现有很多帮助类和扩展辅助方法。这就是一个简单的设计的提升的开始，对完全重复的代码进行拆分，减少重复的代码

以上的练习熟练之后，就可以进行第二步，识别结构重复的代码和相似的代码，减少结构重复的代码和相似的代码的重复。我见过有很多伙伴都止步于此步，如果你还没有对此步熟练，还请不要轻易尝试后面的练习步骤，否则按照我的经验，跳过这一步的开发者写出来的“设计”的“毒”都特别大

重复的结构指的是不完全重复的代码，但是结构上是类似的，或者是代码之间是相似的，往往只是换几个变量或者更改某些执行过程。对于重复的结构的优化是需要投入一点考虑和需要一些开发经验的，因为对重复的结构“开炮”之前，是需要先了解代码的逻辑含义，否则是无法达成等价变更

刚好提到了“等价变更”这个词，需要说明一下，很多时候的优化，无论是设计上的优化还是性能上的优化，都有一个追求是优先做等价变更的更改。所谓等价变更指的是改动前后的代码逻辑上是等价的，而更加严格的指的是执行逻辑的变更是等价的。改动之前和改动之后执行的逻辑是没有变化的，有变化的只是执行过程

假设在优化的时候，能保证 等价变更 那就可以保证优化是不会引入新的问题，也就是不会因为优化而挖坑

在不了解业务细节的时候进行优化，特别需要注意这一点。前面的对重复的代码进行抽离，基本上都是能保持等价变更，除非自己很逗比。然而在进行重复的结构的优化的时候，如果不注意改动前后的逻辑，那确实对于新手来说，就会导致优化前后逻辑不等价，也许就挖坑了。有一个比喻我认为是很对的，前面的做对重复的代码的优化，就好像是做语文的拼音题，照着书抄能满分。而做对重复的结构的优化，就好像是做数学题，书里面只有告诉你公式，照着书抄是写不出答案的，需要自己想一下，通过公式计算

对于新手来说，优先考虑对有单元测试的项目的重复结构的代码的优化开始。单元测试一个很重要的功能就是保证逻辑的等价变更，一旦发现自己的优化导致了逻辑的不等价，单元测试也许是能立刻告诉你逻辑变更了

举个例子，假如有以下的单元测试

> 测试 Foo 方法，在输入边界的参数是 xxxxx 时，期望的返回是 xxxxxx 值

那么在进行对重复结构的代码 Foo 方法优化时，逻辑上没有保持等价改动，导致了对边界逻辑的行为的变更，那么以上的单元测试将无法通过，从而提醒开发者需要小心这里的变更




此章末尾还必须提醒大家，分清需求，重复的代码是要减少而不是要消灭。不是所有的重复代码都是不好的，是否应该让代码重复，取决于需求。例如有两个程序集，逻辑关系上本来就不应该有联系，但是如果只是为了减少重复代码，强行让这两个程序集引用，只是为了调用到某些辅助函数，那无疑这是很亏的事情。不过，如果这两个程序集的重复代码是特别多，那就需要考虑一下是否再加一个程序集包含这两个程序集的重复代码，以让这两个程序集引用这个包含辅助代码的程序集，从而减少重复代码，或者是考虑将这两个程序集从逻辑上拆分但是实际上是由一个项目组建，或者是考虑通过链接引用形式引用相同的一份代码文件，或者是考虑共享项目等等。 再例如某段代码是性能敏感点，性能敏感点的代码是允许有很多破坏设计的改动以及破坏可读性的改动，这部分代码则不要放在改动考虑范围

方法参数优化，不要个数太多

## 减少方法的代码行数

## 减少类型的成员

## 试试设置可访问性级别

考虑可测试

考虑容错

考虑调用方便

写代码前先给点时间



降低逻辑复杂度 考虑扩展性，但是不要过多考虑扩展性 在需求不明确的时候

再需要明确一点，在设计上，是没有不可以或者不可能这句话的。唯一有不可以和不可能的，只有底层组件。设计上，一个绝对完美的方案也是存在的，只是在于人类能不能想到而已。但好在绝大部分情况下，要求都没有那么完美，在符合一定条件下的完美方案是存在的。如果想要提升自己的设计能力，就要少说不可以和不可能，试试设计一下，各个方面都能兼顾是可以实现的。将目标定高一些，即使最后不能完成，一般结果都不会太差

很多时候都需要对自己所拿到的需求进行加工，不一定逻辑上是如何就完全跟着逻辑走。完全跟着逻辑顺着走的方式叫平推，这个方式优点在于理解顺序和逻辑顺序相关，缺点在于复杂度可能上来的时候超级复杂。如果是平推的方法，可以用一个例子说明，如果做某个事情有三步，第一步有三个可能，第二步有三个可能，第三步有三个可能，按照顺序逻辑就是有 27 个分支逻辑，那如果再加一步呢。很快逻辑的复杂度就上来额


设计也是开发的一个部分，是需要投入时间和精力的。很多时候我都无法立刻给出一个小模块的框架的设计，都需要进行思考，或者进行尝试才能知道。在开始进入写代码之前，先刻意让自己等一下，想想设计，也是一个提升的方式。但是有一点必须说明的是，和具体的人有关，有些人的设计是需要拿出纸写的，而有些人是必须敲代码进行设计的，例如我就不喜欢写和画而是喜欢写一些代码，这时候的写代码可不能强行算是写代码哦，这只是一个进行设计的过程。在写代码之前，先让自己停下来，更多指的是让自己去思考一下代码的设计，至于设计时的方式，喜欢用笔写还是喜欢敲代码那就看你的心情



## 给自己一点小要求

如果有遇到设计的代码是可以作为框架的情况，可以适当给自己一点小要求，可以试试以下的列表，将以下列表作为自己的设计的代码的要求

- 方便扩展： 能否在新加功能的时候，不改动或者少改动之前的代码和机制
- 方便静态阅读： 是否在不运行和没在 Visual Studio 的帮助下，也能阅读部分代码，特别是入口的 API 层
- 方便调试： 如果使用过程存在问题，是否很方便提供调试。或者是在使用有误时，及时给出明确错误
- 对 API 进行分层：简单的常用的 API 放在比较好调用的一层，高级的使用方法和带坑的 API 放在比较深的层
- 遵守默认约定：是否自己新写的代码和 dotnet 官方框架或者现有的项目的其他模块的设计十分背离
- 统一性设计：自己的各个模块，模块和模块之间，以及自己和 dotnet 官方框架或现有项目的其他模块之间，是否存在统一性，是不是自己新写的代码是在造自己独立的概念
- 不同的逻辑截然不同：如果有相似但完全不相同的概念，是否会造成其他开发者混淆，有没有让不同的逻辑看起来截然不同
- 开发时做好防逗比：有没有防止其他开发者或者以后的自己进行逗比调用，是否在进行逗比调用时给出明确的提示


以上要求的更多细节，还请参阅 [框架设计的想法](https://blog.lindexi.com/post/%E6%A1%86%E6%9E%B6%E8%AE%BE%E8%AE%A1%E7%9A%84%E6%83%B3%E6%B3%95.html )




<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。欢迎转载、使用、重新发布，但务必保留文章署名[林德熙](http://blog.csdn.net/lindexi_gd)(包含链接:http://blog.csdn.net/lindexi_gd )，不得用于商业目的，基于本文修改后的作品务必以相同的许可发布。如有任何疑问，请与我[联系](mailto:lindexi_gd@163.com)。