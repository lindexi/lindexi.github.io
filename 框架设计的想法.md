# 框架设计的想法

如何开发一个框架，或者如何搭建，如何设计一个框架，很难教会一个新人

<!--more-->
<!-- CreateTime:2021/5/20 8:46:27 -->

<!-- 草稿 -->

## 方便扩展

如果一个框架里面涉及到扩展的功能，例如遇到数据 A 执行 FooA 功能，遇到数据 B 执行 FooB 功能，需要在框架设计的时候，方便业务开发者自行扩展，如加上遇到数据 C 执行 FooC 功能

此时的要点在于，如果新添加一个扩展，在业务端需要写的代码量有多少是业务无关的，接入框架需要的代码量以及需要变更的函数有多少。自然是越少越好

假定设计的框架要求业务开发者在扩展功能的时候，需要写半天的业务无关的用于接入框架的代码，同时需要修改很多个不同项目的很多个函数的代码，求业务开发者心理阴影面积

## 方便静态阅读

静态代码阅读是对于比运行调试阅读代码的方法，通过静态代码可以了解含义以及业务逻辑是比较友好的。这个原则是用来限制新框架开发者使用大量的抽象定义，进行过度设计。假定所有的方法调用等，都进入框架绕一圈出来，所有的传入和传出的参数或执行函数都是抽象的接口定义，或者充满委托，那此时静态代码阅读基本阵亡。如果静态代码阅读不能理解逻辑含义，这就意味着在新增功能或者变更逻辑的时候，将会修改不全面，或者作出了不符合框架预期的行为

也会让新入手此项目的开发者需要投入很多的资源才能开始开发

## 方便调试

如果一个框架没有开放任何调试的入口或调试的方法，那么在使用这个框架的时候，遇到任何的坑都需要将框架参与进入构建来进行调试。这样将会让业务开发者也需要去了解框架本身的逻辑，或者让框架开发者自身需要不断救火

方便调试的实际做法可以是开放一些调试方法，或者有开关进入调试模式，以及输出信息来辅助调试。输出信息包括了异常输出以及日志输出等方式，输出信息是最简洁的方式方便调试。一个进入调试模式的例子是如用户将基于此框架开发一个做几何形状的数学计算库，如果有调试开关，可以打开可视化效果，那这对于开发的效率有提升

在框架里面需要加入一些调试入口，在传输的类型等需要附加一些调试相关信息。以上的调试信息其实更多指的是和用户业务无关的信息，例如读取 Xml 配置的时候，用户业务相关的是配置的内容本身，而调试信息就是如读取的内容对应在 Xml 的行号。如果有 Xml 的行号信息，在开发者遇到配置出错的时候，可以了解到是哪一行出错的，这一行的 Xml 内容是什么，就可以方便开发者进行调试

## 对 API 进行分层

一个大的框架需要有很多层的 API 定义，按照简单和高级用法分为不同的访问方式，对于简单的使用，可以通过一层的 API 进行调用，如 Foo.F1() 等方式。对于高级的用法需要放在里层，如 Foo.F2.F3() 的方式，这样可以减少开发者用错

## 开发时做好防逗比

按照优先级，最高的是构建不通过，其次是运行时抛调试异常，其次是写注释，其次是写文档。如切页 API 只许传入正数，可以让传入参数是正数，而让开发者写不出传入负数的代码。运行时抛出调试异常，可以告诉开发者用法用错了，同时在异常信息里面告诉正确的用法


## 遵守默认约定

如 API 的命名和行为，可以参照 dotnet 的框架的方式，这样开发者用起来就会顺手。如关闭某个功能，如果叫 Close 那就是比较通用的，而如果叫 Exit 尽管能达意，但是开发者也许找不到此方法。如果团队里面成员英文水平不高，那更建议使用接地气的命名法而不是专业的英文，对于特别的算法或难以表述的，可采用中文


<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png" /></a><br />本作品采用<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">知识共享署名-非商业性使用-相同方式共享 4.0 国际许可协议</a>进行许可。欢迎转载、 使用、重新发布，但务必保留文章署名[林德熙](http://blog.csdn.net/lindexi_gd)(包含链接:http://blog.csdn.net/lindexi_gd )，不得用于商业目的，基于本文修改后的作品务必以相同的许可发布。如有任何疑问，请与我[联系](mailto:lindexi_gd@163.com)。  
